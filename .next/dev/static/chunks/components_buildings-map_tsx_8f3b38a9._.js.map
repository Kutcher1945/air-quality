{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/adilannister/admin_related/air-quality-data/components/buildings-map.tsx"],"sourcesContent":["\"use client\"\n\nimport { useEffect, useRef } from \"react\"\nimport L from \"leaflet\"\nimport \"leaflet/dist/leaflet.css\"\nimport \"leaflet.markercluster/dist/leaflet.markercluster\"\nimport \"leaflet.markercluster/dist/MarkerCluster.css\"\nimport \"leaflet.markercluster/dist/MarkerCluster.Default.css\"\nimport \"leaflet.heat\"\n\nif (typeof window !== 'undefined') {\n  require('leaflet.vectorgrid');\n}\n\ninterface Building {\n  id: string\n  address: string\n  district: string\n  latitude: number\n  longitude: number\n  has_gas: boolean | null\n  building_type: string\n  building_type_raw?: string | null\n  building_category: \"general\" | \"izhs\" | \"susn\"\n  is_seasonal_or_unused?: boolean\n  is_approximate?: boolean | null\n  geometry?: {\n    type: string\n    coordinates: any\n  } | null\n  floors?: number\n  apartments?: number\n  year_built?: number\n}\n\ninterface RenovationArea {\n  id: number\n  name_ru: string\n  name_kz?: string | null\n  address?: string | null\n  number_of_houses?: number | null\n  number_of_apartments?: number | null\n  plot_area?: string | null\n  photo_url?: string | null\n  geometry?: {\n    type: string\n    coordinates: any\n  } | null\n  created_at: string\n}\n\ninterface District {\n  id: number\n  name: string\n  geometry?: {\n    type: string\n    coordinates: any\n  } | null\n}\n\ninterface BuildingsMapProps {\n  buildings: Building[]\n  renovationAreas?: RenovationArea[]\n  districts?: District[]\n  selectedDistrictId?: number | null\n  showHeatmap?: boolean\n  showRenovationAreas?: boolean\n  showOnlySeasonalUnused?: boolean\n  onBuildingClick?: (building: Building) => void\n}\n\n// Fix Leaflet default marker icon issue\ndelete (L.Icon.Default.prototype as any)._getIconUrl\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png\",\n  iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png\",\n  shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png\",\n})\n\nconst IZHS_NON_RESIDENTIAL_TYPES = [\n  '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–µ –∑–¥–∞–Ω–∏–µ',\n  '–ú–∞–≥–∞–∑–∏–Ω',\n  '–°—Ç—Ä–æ—è—â–µ–µ—Å—è –∑–¥–∞–Ω–∏–µ',\n  '–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å',\n  '–û–±—â–µ–∂–∏—Ç–∏–µ',\n  '–•–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ—Ä–ø—É—Å',\n  '–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã',\n  '–ö–∞—Ñ–µ, –±–∞—Ä',\n  '–í–µ—Ç–ª–µ—á–µ–±–Ω–∏—Ü–∞',\n  '–°—Ç—Ä–æ—è—â–∏–π—Å—è –∫–æ—Ç—Ç–µ–¥–∂',\n  '–°—Ç—Ä–æ—è—â–µ–µ—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–µ –∑–¥–∞–Ω–∏–µ',\n  '–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ—Ä–ø—É—Å',\n  '–ö–∏–æ—Å–∫',\n  '–ë–∞–Ω–∏, —Å–∞—É–Ω—ã',\n  '–ì–æ—Å—Ç–∏–Ω–∏—Ü–∞',\n  '–ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –∑–∞—Å—Ç—Ä–æ–π–∫–∞',\n  '–°—Ç—Ä–æ—è—â–∏–π—Å—è —Ç–∞—É–Ω—Ö–∞—É—Å',\n  '–î–µ—Ç—Å–∫–∏–π —Å–∞–¥, —è—Å–ª–∏',\n  '–†–µ–ª–∏–≥–∏–æ–∑–Ω–æ–µ —Å–æ–æ—Ä—É–∂–µ–Ω–∏–µ',\n  '–ì–∞—Ä–∞–∂',\n  '–†–µ–º–æ–Ω—Ç–∏—Ä—É–µ–º–æ–µ –∑–¥–∞–Ω–∏–µ',\n  '–ê–≤—Ç–æ–º–æ–π–∫–∞',\n  '–†–µ—Å—Ç–æ—Ä–∞–Ω',\n  '–ê–≤—Ç–æ—Ü–µ–Ω—Ç—Ä',\n  '–°–∫–ª–∞–¥',\n  '–°—Ç–æ–ª–æ–≤–∞—è',\n  '–¢–æ—Ä–≥–æ–≤—ã–π –ø–∞–≤–∏–ª—å–æ–Ω',\n  '–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ',\n  '–®–∏–Ω–æ–º–æ–Ω—Ç–∞–∂',\n  '–®–∫–æ–ª–∞',\n  '–°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ —Å–æ–æ—Ä—É–∂–µ–Ω–∏–µ',\n]\n\n// 3 marker designs:\n//  1. –ù–µ –ò–ñ–° —Ç–∏–ø—ã  ‚Üí purple üè¨  (kept as-is)\n//  2. is_approximate = true  ‚Üí yellow üè†  (approximate coordinates)\n//  3. is_approximate = false/null ‚Üí green üè†  (exact coordinates)\n// + ‚ùÑÔ∏è pink pin when seasonal filter is toggled on\nconst createMarkerIcon = (\n  isSeasonalOrUnused?: boolean,\n  buildingTypeRaw?: string | null,\n  showOnlySeasonalUnused?: boolean,\n  isApproximate?: boolean | null,\n) => {\n  // ‚ùÑÔ∏è pink pin only when seasonal filter is actively toggled on\n  if (isSeasonalOrUnused && showOnlySeasonalUnused) {\n    return L.divIcon({\n      className: \"custom-marker seasonal-marker\",\n      html: `\n        <div style=\"\n          background-color: #ec4899;\n          width: 36px;\n          height: 36px;\n          border-radius: 50% 50% 50% 0;\n          transform: rotate(-45deg);\n          border: 3px solid white;\n          box-shadow: 0 2px 12px rgba(236, 72, 153, 0.5);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          opacity: 0.95;\n          backdrop-filter: blur(2px);\n          transition: opacity 0.2s ease;\n        \">\n          <div style=\"\n            transform: rotate(45deg);\n            color: white;\n            font-size: 16px;\n            font-weight: bold;\n          \">‚ùÑÔ∏è</div>\n        </div>\n      `,\n      iconSize: [36, 36],\n      iconAnchor: [18, 36],\n      popupAnchor: [0, -36],\n    })\n  }\n\n  let color: string\n  let icon: string\n  const raw = (buildingTypeRaw || \"\").trim()\n\n  if (raw && IZHS_NON_RESIDENTIAL_TYPES.includes(raw)) {\n    // –ù–µ –ò–ñ–° —Ç–∏–ø—ã ‚Äî purple\n    color = \"#8b5cf6\"\n    icon = \"üè¨\"\n  } else if (isApproximate === true) {\n    // Approximate coordinates ‚Äî yellow\n    color = \"#eab308\"\n    icon = \"üè†\"\n  } else {\n    // Exact coordinates (false / null) ‚Äî green\n    color = \"#10b981\"\n    icon = \"üè†\"\n  }\n\n  return L.divIcon({\n    className: \"custom-marker\",\n    html: `\n      <div style=\"\n        background-color: ${color};\n        width: 32px;\n        height: 32px;\n        border-radius: 50% 50% 50% 0;\n        transform: rotate(-45deg);\n        border: 3px solid white;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        opacity: 0.85;\n        backdrop-filter: blur(2px);\n        transition: opacity 0.2s ease;\n      \">\n        <div style=\"\n          transform: rotate(45deg);\n          color: white;\n          font-size: 18px;\n          font-weight: bold;\n        \">${icon}</div>\n      </div>\n    `,\n    iconSize: [32, 32],\n    iconAnchor: [16, 32],\n    popupAnchor: [0, -32],\n  })\n}\n\nexport default function BuildingsMap({\n  buildings,\n  renovationAreas = [],\n  districts = [],\n  selectedDistrictId = null,\n  showHeatmap = false,\n  showRenovationAreas = false,\n  showOnlySeasonalUnused = false,\n  onBuildingClick\n}: BuildingsMapProps) {\n  const mapRef = useRef<HTMLDivElement>(null)\n  const mapInstanceRef = useRef<L.Map | null>(null)\n  const heatLayerRef = useRef<any>(null)\n  const clusterGroupRef = useRef<any>(null)\n  const districtLayerRef = useRef<L.LayerGroup | null>(null)\n  const renovationLayerRef = useRef<L.LayerGroup | null>(null)\n  const onBuildingClickRef = useRef(onBuildingClick)\n  const hasAutoFitted = useRef(false)\n  const canvasRendererRef = useRef<L.Canvas | null>(null)\n  const isUnmountingRef = useRef(false)\n  const previousDistrictIdRef = useRef<number | null | undefined>(undefined)\n\n  const heatmapLegendItems = [\n    { color: '#22c55e', label: '0 –∑–¥–∞–Ω–∏–π' },\n    { color: '#FFD700', label: '1 –∑–¥–∞–Ω–∏–µ' },\n    { color: '#f97316', label: '2 - 4 –∑–¥–∞–Ω–∏—è' },\n    { color: '#cf7e88', label: '5 –∑–¥–∞–Ω–∏–π' },\n    { color: '#ef4444', label: '6 - 20 –∑–¥–∞–Ω–∏–π' },\n    { color: '#7f1d1d', label: '–±–æ–ª–µ–µ 20' },\n  ];\n\n  const HeatmapLegend = () => {\n    return (\n      <div className=\"absolute bottom-0 right-0 z-[1000] bg-white/90 backdrop-blur-md p-4 rounded-xl shadow-xl border border-gray-200 pointer-events-none min-w-[140px]\">\n        <div className=\"text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-3\">\n          –ó–¥–∞–Ω–∏–π –±–µ–∑ –≥–∞–∑–∞\n        </div>\n        <div className=\"grid grid-cols-2 gap-2\">\n          {heatmapLegendItems.map((item, index) => (\n            <div key={index} className=\"flex items-center gap-3\">\n              <div \n                className=\"w-4 h-4 rounded-sm shadow-inner\" \n                style={{ backgroundColor: item.color }} \n              />\n              <span className=\"text-xs font-semibold text-gray-700\">{item.label}</span>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  };\n\n  // Keep the ref updated with the latest callback\n  useEffect(() => {\n    onBuildingClickRef.current = onBuildingClick\n  }, [onBuildingClick])\n\n  useEffect(() => {\n    if ('serviceWorker' in navigator) {\n      navigator.serviceWorker.register('/tile-sw.js')\n        .then(() => console.log(\"Tile Cache Worker Registered\"));\n    }\n  }, []);\n\n  // Initialize map only once\n  useEffect(() => {\n    if (typeof window === \"undefined\" || !mapRef.current || mapInstanceRef.current) return\n\n    // Reset unmounting flag on mount\n    isUnmountingRef.current = false\n\n    // Center of Almaty\n    const mapCenter: [number, number] = [43.238293, 76.945465]\n\n    // Create canvas renderer for better performance with many markers\n    canvasRendererRef.current = L.canvas({ padding: 0.5 })\n\n    // Create Leaflet map with EPSG:3395 CRS for Yandex tiles\n    const map = L.map(mapRef.current, {\n      // crs: L.CRS.EPSG3395, // Yandex uses Mercator projection (EPSG:3395)\n      crs: L.CRS.EPSG3857,\n      center: mapCenter,\n      zoom: 11,\n      preferCanvas: true, // Use canvas for better performance\n      renderer: canvasRendererRef.current,\n      zoomAnimation: true,\n      markerZoomAnimation: true,\n      fadeAnimation: true,\n      // Performance optimizations\n      wheelDebounceTime: 40,\n      // wheelDebounceTime: 100,\n      // wheelPxPerZoomLevel: 60,\n    })\n\n    // Add Yandex tiles layer (no API key needed!)\n    // L.tileLayer(\"https://core-renderer-tiles.maps.yandex.net/tiles?l=map&x={x}&y={y}&z={z}&lang=ru_RU\", {\n    //   attribution: '&copy; <a href=\"https://yandex.com/maps/\">Yandex</a>',\n    //   maxZoom: 21, // Increased max zoom for closer inspection\n    //   minZoom: 0,\n    //   updateWhenIdle: false, // Update tiles during movement for smoother experience\n    //   updateWhenZooming: false, // Don't update while zooming\n    //   keepBuffer: 2, // Keep more tiles in buffer for smooth panning\n    // }).addTo(map)\n\n    L.tileLayer(\"https://core-renderer-tiles.maps.yandex.net/tiles?l=map&x={x}&y={y}&z={z}&lang=ru_RU&projection=web_mercator\", {\n      attribution: '&copy; <a href=\"https://yandex.com/maps/\">Yandex</a>',\n      maxZoom: 21,\n      minZoom: 0,\n      updateWhenIdle: false,\n      keepBuffer: 2,\n    }).addTo(map)\n\n    mapInstanceRef.current = map\n\n    return () => {\n      isUnmountingRef.current = true\n      const currentMap = mapInstanceRef.current\n      if (currentMap) {\n        // Stop all pending animations and redraws first\n        currentMap.stop()\n\n        if (heatLayerRef.current) {\n          try {\n            currentMap.removeLayer(heatLayerRef.current)\n          } catch (e) { /* ignore cleanup errors */ }\n          heatLayerRef.current = null\n        }\n        if (clusterGroupRef.current) {\n          try {\n            clusterGroupRef.current.clearLayers()\n            currentMap.removeLayer(clusterGroupRef.current)\n          } catch (e) { /* ignore cleanup errors */ }\n          clusterGroupRef.current = null\n        }\n        if (districtLayerRef.current) {\n          try {\n            currentMap.removeLayer(districtLayerRef.current)\n          } catch (e) { /* ignore cleanup errors */ }\n          districtLayerRef.current = null\n        }\n        if (renovationLayerRef.current) {\n          try {\n            currentMap.removeLayer(renovationLayerRef.current)\n          } catch (e) { /* ignore cleanup errors */ }\n          renovationLayerRef.current = null\n        }\n\n        // Clear canvas renderer\n        if (canvasRendererRef.current) {\n          try {\n            canvasRendererRef.current.remove()\n          } catch (e) { /* ignore cleanup errors */ }\n          canvasRendererRef.current = null\n        }\n\n        currentMap.off()\n        currentMap.remove()\n        mapInstanceRef.current = null\n      }\n    }\n  }, [])\n\n  useEffect(() => {\n    if (!mapInstanceRef.current || typeof window === \"undefined\" || isUnmountingRef.current) return\n\n    const map = mapInstanceRef.current\n    let cancelled = false\n\n    // Helper function to safely remove layers\n    const safeRemoveLayer = (layer: any) => {\n      if (!layer || !mapInstanceRef.current || isUnmountingRef.current) return\n      try {\n        mapInstanceRef.current.removeLayer(layer)\n      } catch (e) {\n        // Ignore errors during layer removal (canvas might be destroyed)\n      }\n    }\n\n    // Clear existing layers\n    if (heatLayerRef.current) {\n      safeRemoveLayer(heatLayerRef.current)\n      heatLayerRef.current = null\n    }\n    if (clusterGroupRef.current) {\n      safeRemoveLayer(clusterGroupRef.current)\n      clusterGroupRef.current = null\n    }\n    if (districtLayerRef.current) {\n      safeRemoveLayer(districtLayerRef.current)\n      districtLayerRef.current = null\n    }\n    if (renovationLayerRef.current) {\n      safeRemoveLayer(renovationLayerRef.current)\n      renovationLayerRef.current = null\n    }\n\n    if (cancelled || !mapInstanceRef.current || isUnmountingRef.current) return\n\n    if (showHeatmap) {\n      const VectorGrid = (L as any).vectorGrid;\n\n      if (VectorGrid) {\n        const heatmapUrl = \"https://admin.smartalmaty.kz/api/v1/address/gas-heatmap/tiles/{z}/{x}/{y}.pbf\";\n        \n        const heatLayer = VectorGrid.protobuf(heatmapUrl, {\n          // rendererFactory: (L as any).svg.tile,\n          rendererFactory: (L as any).canvas.tile,\n          vectorTileLayerStyles: {\n            heatmap: (properties: any) => {\n              if (selectedDistrictId && properties.district_id !== selectedDistrictId) {\n                return {\n                  fill: false,\n                  stroke: false,\n                  opacity: 0,\n                  fillOpacity: 0\n                };\n              }\n              const val = Number(properties.intensity || 0);\n              \n              let color;\n              if (val === 0) {\n                color = '#22c55e';\n              } else if (val === 1) {\n                color = '#FFD700';\n              } else if (val < 5) {\n                color = '#f97316';\n              } else if (val === 5) {\n                color = '#cf7e88ff';\n              } else if (val <= 20) {\n                color = '#ef4444';\n              } else {\n                color = '#7f1d1d';\n              }\n\n              return {\n                fill: true,\n                fillColor: color,\n                fillOpacity: 0.75,\n                stroke: false,\n                color: color,\n                weight: 1,\n                opacity: 0.2,\n              };\n            }\n          },\n          // srid: 3857, \n          interactive: true,\n          getFeatureId: (f: any) => f.properties.id, //new\n          maxNativeZoom: 14, //new\n          maxZoom: 21, //new\n          updateWhenIdle: true, //new\n          updateWhenZooming: false, //new\n          zIndex: 1000,\n          keepBuffer: 4, // Keep more tiles in memory to prevent white flickering\n          buffer: 512, // Larger buffer helps with labels/edges\n        });\n\n        if (!cancelled && !isUnmountingRef.current && mapInstanceRef.current) {\n          try {\n            heatLayer.addTo(map);\n            heatLayerRef.current = heatLayer;\n          } catch (e) { /* ignore layer add errors */ }\n        }\n      }\n    } else {\n      // Cluster markers for performance on large datasets\n      // @ts-ignore markercluster is attached to L by side-effect import\n      const clusterGroup = L.markerClusterGroup({\n        disableClusteringAtZoom: 17, // Increased to 17 - keeps clustering longer for better performance\n        chunkedLoading: true,\n        chunkInterval: 200, // Faster chunk processing\n        chunkDelay: 50, // Less delay between chunks\n        maxClusterRadius: 60, // Increased radius for better grouping\n        spiderfyOnMaxZoom: true,\n        showCoverageOnHover: false, // Disable coverage on hover - improves performance\n        spiderfyDistanceMultiplier: 2, // Spread out spiderfied markers more\n        removeOutsideVisibleBounds: true, // Remove markers outside viewport for performance\n        animate: true, // Smooth animations\n        animateAddingMarkers: false, // Disable animation when adding markers for speed\n        iconCreateFunction: function (cluster: any) {\n          const markers = cluster.getAllChildMarkers()\n          const count = markers.length\n\n          // Count buildings by category\n          const categories = { general: 0, izhs: 0, susn: 0 }\n          markers.forEach((marker: any) => {\n            const building = marker.options.buildingData\n            if (building && building.building_category) {\n              const cat = building.building_category as keyof typeof categories\n              categories[cat]++\n            }\n          })\n\n          // Determine dominant category\n          let dominantCategory: \"general\" | \"izhs\" | \"susn\" = \"general\"\n          let maxCount = categories.general\n          if (categories.izhs > maxCount) {\n            dominantCategory = \"izhs\"\n            maxCount = categories.izhs\n          }\n          if (categories.susn > maxCount) {\n            dominantCategory = \"susn\"\n          }\n\n          // Color based on dominant category\n          const colors = {\n            general: \"#f97316\", // Orange\n            izhs: \"#3b82f6\",    // Blue\n            susn: \"#ef4444\",    // Red\n          }\n          const color = colors[dominantCategory]\n\n          // Size based on count\n          let size: \"small\" | \"medium\" | \"large\" = \"small\"\n          if (count >= 100) size = \"large\"\n          else if (count >= 50) size = \"medium\"\n\n          const sizeMap = {\n            small: \"40px\",\n            medium: \"50px\",\n            large: \"60px\",\n          }\n\n          return L.divIcon({\n            html: `\n              <div style=\"\n                background: ${color};\n                width: ${sizeMap[size]};\n                height: ${sizeMap[size]};\n                border-radius: 50%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                border: 4px solid white;\n                box-shadow: 0 4px 12px rgba(0,0,0,0.25);\n                font-weight: bold;\n                color: white;\n                font-size: ${size === \"large\" ? \"18px\" : size === \"medium\" ? \"16px\" : \"14px\"};\n                opacity: 0.85;\n                backdrop-filter: blur(2px);\n                transition: opacity 0.2s ease;\n              \">\n                ${count}\n              </div>\n              <div style=\"\n                position: absolute;\n                bottom: -20px;\n                left: 50%;\n                transform: translateX(-50%);\n                background: rgba(0,0,0,0.7);\n                color: white;\n                padding: 2px 6px;\n                border-radius: 10px;\n                font-size: 9px;\n                white-space: nowrap;\n                display: none;\n              \" class=\"cluster-label\">\n                ${categories.general > 0 ? `üè†${categories.general}` : \"\"}\n                ${categories.izhs > 0 ? `üè°${categories.izhs}` : \"\"}\n                ${categories.susn > 0 ? `üè¢${categories.susn}` : \"\"}\n              </div>\n            `,\n            className: \"custom-cluster-icon\",\n            iconSize: L.point(parseInt(sizeMap[size]), parseInt(sizeMap[size])),\n          })\n        },\n      })\n\n      console.log(`üó∫Ô∏è Creating markers for ${buildings.length} buildings`)\n\n      // Skip marker creation if no buildings\n      if (buildings.length === 0) {\n        console.log(\"‚ö†Ô∏è No buildings to display on map\")\n        return\n      }\n\n      let markersCreated = 0\n      buildings.forEach((building) => {\n        // Skip buildings without valid coordinates\n        if (!building.latitude || !building.longitude) return\n        // Use different colored icon based on building category and seasonal/unused status\n        const icon = createMarkerIcon(\n          building.is_seasonal_or_unused,\n          building.building_type_raw,\n          showOnlySeasonalUnused,\n          building.is_approximate,\n        )\n\n        const marker = L.marker([building.latitude, building.longitude], {\n          icon,\n          buildingData: building // Store building data for cluster calculations\n        } as any).bindPopup(\n          `\n          <div style=\"padding: 8px; min-width: 200px;\">\n            <strong style=\"font-size: 14px;\">${building.address}</strong>\n            ${building.is_seasonal_or_unused ? `<span style=\"display: inline-block; margin-left: 8px; padding: 2px 6px; background: #fdf2f8; color: #be185d; font-size: 10px; border-radius: 4px; font-weight: bold;\">‚ùÑÔ∏è –°–µ–∑–æ–Ω–Ω–æ–µ</span>` : \"\"}\n            <hr style=\"margin: 8px 0; border: none; border-top: 1px solid #e5e7eb;\">\n            <p style=\"margin: 4px 0; font-size: 12px;\"><strong>–†–∞–π–æ–Ω:</strong> ${building.district}</p>\n            <p style=\"margin: 4px 0; font-size: 12px;\"><strong>–¢–∏–ø:</strong> ${building.building_type}</p>\n            ${building.floors ? `<p style=\"margin: 4px 0; font-size: 12px;\"><strong>–≠—Ç–∞–∂–µ–π:</strong> ${building.floors}</p>` : \"\"}\n            ${building.apartments ? `<p style=\"margin: 4px 0; font-size: 12px;\"><strong>–ö–≤–∞—Ä—Ç–∏—Ä:</strong> ${building.apartments}</p>` : \"\"}\n            ${building.year_built ? `<p style=\"margin: 4px 0; font-size: 12px;\"><strong>–ì–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏:</strong> ${building.year_built}</p>` : \"\"}\n            <p style=\"margin: 8px 0 4px; color: #f97316; font-weight: bold; font-size: 12px;\">‚ö†Ô∏è –ë–µ–∑ –≥–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è</p>\n          </div>\n        `,\n        )\n\n        // Add click event to open side panel\n        marker.on(\"click\", () => {\n          if (onBuildingClickRef.current) {\n            onBuildingClickRef.current(building)\n          }\n        })\n\n        clusterGroup.addLayer(marker)\n        markersCreated++\n\n        // Draw polygons only at high zoom for performance (zoom 16+)\n        // Commented out to improve performance\n        /* if (building.geometry && building.geometry.type === \"MultiPolygon\" && map.getZoom() >= 16) {\n          const latLngPolys: L.LatLngExpression[][] = []\n          building.geometry.coordinates.forEach((poly: any) => {\n            const ring = poly[0]\n            const latLngs = ring.map((coord: [number, number]) => [coord[1], coord[0]])\n            latLngPolys.push(latLngs)\n          })\n          const htmlString = typeof icon.options.html === \"string\" ? icon.options.html : \"\"\n\n          // Determine color based on building category\n          const polygonColor = htmlString.includes(\"#3b82f6\")\n            ? \"#3b82f6\"\n            : htmlString.includes(\"#ef4444\")\n              ? \"#ef4444\"\n              : \"#f97316\"\n\n          L.polygon(latLngPolys, {\n            color: polygonColor,\n            weight: 1,\n            fillOpacity: 0.15,\n            renderer: canvasRendererRef.current || undefined, // Use canvas renderer for better performance\n            interactive: false, // Disable interaction to improve performance\n            smoothFactor: 2, // Simplify polygon for performance\n          }).addTo(map)\n        } */\n      })\n\n      // Add hover tooltip to clusters to show statistics\n      clusterGroup.on(\"clustermouseover\", function (event: any) {\n        const cluster = event.layer\n        const markers = cluster.getAllChildMarkers()\n\n        // Count buildings by category\n        const categories = { general: 0, izhs: 0, susn: 0 }\n        markers.forEach((marker: any) => {\n          const building = marker.options.buildingData\n          if (building && building.building_category) {\n            const cat = building.building_category as keyof typeof categories\n            categories[cat]++\n          }\n        })\n\n        const tooltipContent = `\n          <div style=\"padding: 10px; min-width: 180px; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);\">\n            <h3 style=\"font-size: 13px; font-weight: bold; margin-bottom: 8px; color: #111827;\">\n              –ö–ª–∞—Å—Ç–µ—Ä: ${markers.length} –∑–¥–∞–Ω–∏–π\n            </h3>\n            <div style=\"display: flex; flex-direction: column; gap: 6px;\">\n              ${categories.general > 0 ? `\n                <div style=\"display: flex; align-items: center; justify-content: space-between; padding: 4px 8px; background: #fff7ed; border-left: 3px solid #f97316; border-radius: 4px;\">\n                  <span style=\"font-size: 11px; color: #9a3412;\">üè† ALSECO</span>\n                  <span style=\"font-size: 13px; font-weight: bold; color: #f97316;\">${categories.general}</span>\n                </div>\n              ` : \"\"}\n              ${categories.izhs > 0 ? `\n                <div style=\"display: flex; align-items: center; justify-content: space-between; padding: 4px 8px; background: #eff6ff; border-left: 3px solid #3b82f6; border-radius: 4px;\">\n                  <span style=\"font-size: 11px; color: #1e3a8a;\">üè° –î–∞–Ω–Ω—ã–µ –†–∞–π–æ–Ω–Ω—ã—Ö –∞–∫–∏–º–∞—Ç–æ–≤</span>\n                  <span style=\"font-size: 13px; font-weight: bold; color: #3b82f6;\">${categories.izhs}</span>\n                </div>\n              ` : \"\"}\n              ${categories.susn > 0 ? `\n                <div style=\"display: flex; align-items: center; justify-content: space-between; padding: 4px 8px; background: #fef2f2; border-left: 3px solid #ef4444; border-radius: 4px;\">\n                  <span style=\"font-size: 11px; color: #7f1d1d;\">üè¢ –î–∞–Ω–Ω—ã–µ –î–ß–°</span>\n                  <span style=\"font-size: 13px; font-weight: bold; color: #ef4444;\">${categories.susn}</span>\n                </div>\n              ` : \"\"}\n            </div>\n            <p style=\"margin-top: 8px; font-size: 9px; color: #6b7280; text-align: center;\">\n              –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è\n            </p>\n          </div>\n        `\n\n        cluster.bindTooltip(tooltipContent, {\n          permanent: false,\n          direction: \"top\",\n          className: \"cluster-tooltip\",\n          offset: [0, -10],\n        }).openTooltip()\n      })\n\n      clusterGroup.on(\"clustermouseout\", function (event: any) {\n        const cluster = event.layer\n        cluster.closeTooltip()\n      })\n\n      // Click cluster to zoom in\n      clusterGroup.on(\"clusterclick\", function (event: any) {\n        const cluster = event.layer\n        cluster.zoomToBounds({ padding: [50, 50] })\n      })\n\n      if (!cancelled && !isUnmountingRef.current && mapInstanceRef.current) {\n        try {\n          clusterGroup.addTo(map)\n          clusterGroupRef.current = clusterGroup\n        } catch (e) { /* ignore cluster add errors */ }\n      }\n\n      console.log(`‚úÖ Successfully created ${markersCreated} markers on the map`)\n    }\n\n    // Render district polygons (filter by selectedDistrictId if specified)\n    if (districts.length > 0) {\n      const districtLayer = L.layerGroup()\n\n      // Filter districts: show only selected one if specified, otherwise show all\n      const districtsToRender = selectedDistrictId !== null\n        ? districts.filter(d => d.id === selectedDistrictId)\n        : districts\n\n      let selectedDistrictBounds: L.LatLngBounds | null = null\n\n      districtsToRender.forEach((district) => {\n        if (district.geometry && (district.geometry.type === \"Polygon\" || district.geometry.type === \"MultiPolygon\")) {\n          const coordinates = district.geometry.coordinates\n          const isSelected = district.id === selectedDistrictId\n\n          if (district.geometry.type === \"Polygon\") {\n            // Single polygon\n            const latLngs = coordinates[0].map((coord: [number, number]) => [coord[1], coord[0]])\n\n            const districtPolygon = L.polygon([latLngs], {\n              color: isSelected ? \"#3b82f6\" : \"#64748b\", // Blue for selected, slate gray for others\n              weight: isSelected ? 3 : 2,\n              fillOpacity: isSelected ? 0.15 : 0.05,\n              fillColor: isSelected ? \"#3b82f6\" : \"#94a3b8\",\n              renderer: !isUnmountingRef.current && canvasRendererRef.current ? canvasRendererRef.current : undefined,\n            })\n\n            const popupContent = `\n              <div style=\"padding: 8px; min-width: 150px;\">\n                <strong style=\"font-size: 14px; color: ${isSelected ? '#3b82f6' : '#64748b'};\">üìç ${district.name}</strong>\n              </div>\n            `\n            districtPolygon.bindPopup(popupContent)\n            districtLayer.addLayer(districtPolygon)\n\n            // Store bounds for zooming if this is the selected district\n            if (isSelected) {\n              selectedDistrictBounds = districtPolygon.getBounds()\n            }\n          } else if (district.geometry.type === \"MultiPolygon\") {\n            // Multiple polygons\n            const latLngPolys: L.LatLngExpression[][] = []\n            coordinates.forEach((polygon: any) => {\n              polygon.forEach((ring: any) => {\n                const latLngs = ring.map((coord: [number, number]) => [coord[1], coord[0]])\n                latLngPolys.push(latLngs)\n              })\n            })\n\n            const districtPolygon = L.polygon(latLngPolys, {\n              color: isSelected ? \"#3b82f6\" : \"#64748b\", // Blue for selected, slate gray for others\n              weight: isSelected ? 3 : 2,\n              fillOpacity: isSelected ? 0.15 : 0.05,\n              fillColor: isSelected ? \"#3b82f6\" : \"#94a3b8\",\n              renderer: !isUnmountingRef.current && canvasRendererRef.current ? canvasRendererRef.current : undefined,\n            })\n\n            const popupContent = `\n              <div style=\"padding: 8px; min-width: 150px;\">\n                <strong style=\"font-size: 14px; color: ${isSelected ? '#3b82f6' : '#64748b'};\">üìç ${district.name}</strong>\n              </div>\n            `\n            districtPolygon.bindPopup(popupContent)\n            districtLayer.addLayer(districtPolygon)\n\n            // Store bounds for zooming if this is the selected district\n            if (isSelected) {\n              selectedDistrictBounds = districtPolygon.getBounds()\n            }\n          }\n        }\n      })\n\n      if (!cancelled && !isUnmountingRef.current && mapInstanceRef.current) {\n        try {\n          districtLayer.addTo(map)\n          districtLayerRef.current = districtLayer\n        } catch (e) { /* ignore district layer add errors */ }\n      }\n\n      // Zoom to selected district if one is selected, or reset to Almaty view\n      // Only change view if district selection actually changed (not on every re-render)\n      const districtChanged = previousDistrictIdRef.current !== selectedDistrictId\n      if (!cancelled && !isUnmountingRef.current && mapInstanceRef.current && districtChanged) {\n        previousDistrictIdRef.current = selectedDistrictId\n        if (selectedDistrictId !== null && selectedDistrictBounds) {\n          try {\n            map.fitBounds(selectedDistrictBounds, {\n              padding: [50, 50],\n              maxZoom: 14 // Don't zoom in too close\n            })\n            console.log(`üéØ Zoomed to district ID ${selectedDistrictId}`)\n          } catch (e) { /* ignore zoom errors during transitions */ }\n        } else if (selectedDistrictId === null) {\n          // Reset to default Almaty view when \"–í—Å–µ —Ä–∞–π–æ–Ω—ã\" or \"–ë–µ–∑ —Ä–∞–π–æ–Ω–∞\" is selected\n          const almatyCenter: [number, number] = [43.238293, 76.945465]\n          const defaultZoom = 11\n          try {\n            map.setView(almatyCenter, defaultZoom, { animate: true })\n            console.log(`üèôÔ∏è Reset view to all Almaty`)\n          } catch (e) { /* ignore view errors during transitions */ }\n        }\n      }\n\n      console.log(`‚úÖ Successfully rendered ${districtsToRender.length} district polygon(s)`)\n    }\n\n    // Render renovation areas if enabled\n    if (showRenovationAreas && renovationAreas.length > 0) {\n      const renovationLayer = L.layerGroup()\n\n      renovationAreas.forEach((area) => {\n        if (area.geometry && area.geometry.type === \"MultiPolygon\") {\n          const coordinates = area.geometry.coordinates\n\n          // Convert MultiPolygon coordinates to Leaflet format\n          const latLngPolys: L.LatLngExpression[][] = []\n          coordinates.forEach((polygon: any) => {\n            polygon.forEach((ring: any) => {\n              const latLngs = ring.map((coord: [number, number]) => [coord[1], coord[0]])\n              latLngPolys.push(latLngs)\n            })\n          })\n\n          // Create polygon with styling\n          const renovationPolygon = L.polygon(latLngPolys, {\n            color: \"#8b5cf6\", // Purple color for renovation areas\n            weight: 2,\n            fillOpacity: 0.2,\n            fillColor: \"#8b5cf6\",\n            renderer: !isUnmountingRef.current && canvasRendererRef.current ? canvasRendererRef.current : undefined,\n          })\n\n          // Add popup with renovation area information\n          const popupContent = `\n            <div style=\"padding: 8px; min-width: 200px;\">\n              <strong style=\"font-size: 14px; color: #8b5cf6;\">üèóÔ∏è ${area.name_ru}</strong>\n              <hr style=\"margin: 8px 0; border: none; border-top: 1px solid #e5e7eb;\">\n              ${area.address ? `<p style=\"margin: 4px 0; font-size: 12px;\"><strong>–ê–¥—Ä–µ—Å:</strong> ${area.address}</p>` : \"\"}\n              ${area.number_of_houses ? `<p style=\"margin: 4px 0; font-size: 12px;\"><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–º–æ–≤:</strong> ${area.number_of_houses}</p>` : \"\"}\n              ${area.number_of_apartments ? `<p style=\"margin: 4px 0; font-size: 12px;\"><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä:</strong> ${area.number_of_apartments}</p>` : \"\"}\n              ${area.plot_area ? `<p style=\"margin: 4px 0; font-size: 12px;\"><strong>–ü–ª–æ—â–∞–¥—å —É—á–∞—Å—Ç–∫–∞:</strong> ${area.plot_area}</p>` : \"\"}\n              ${area.photo_url ? `<img src=\"${area.photo_url}\" alt=\"${area.name_ru}\" style=\"width: 100%; margin-top: 8px; border-radius: 4px;\" />` : \"\"}\n            </div>\n          `\n          renovationPolygon.bindPopup(popupContent)\n\n          renovationLayer.addLayer(renovationPolygon)\n        }\n      })\n\n      if (!cancelled && !isUnmountingRef.current && mapInstanceRef.current) {\n        try {\n          renovationLayer.addTo(map)\n          renovationLayerRef.current = renovationLayer\n          console.log(`‚úÖ Successfully rendered ${renovationAreas.length} renovation areas`)\n        } catch (e) { /* ignore renovation layer add errors */ }\n      }\n    }\n\n    // Auto-fit bounds only on first load, not on subsequent re-renders\n    const validBuildings = buildings.filter(b => b.latitude && b.longitude)\n    if (validBuildings.length > 0 && !hasAutoFitted.current) {\n      const bounds = L.latLngBounds(validBuildings.map((b) => [b.latitude, b.longitude]))\n      if (!cancelled && !isUnmountingRef.current && mapInstanceRef.current) {\n        try {\n          map.fitBounds(bounds, { padding: [50, 50] })\n          hasAutoFitted.current = true\n        } catch (e) { /* ignore bounds errors during initial load */ }\n      }\n    }\n    return () => {\n      cancelled = true\n      // Note: We don't clean up layers here because the effect body already\n      // clears them at the start. Cleaning here would cause race conditions\n      // with the new effect that runs immediately after.\n    }\n  }, [buildings, showHeatmap, showRenovationAreas, renovationAreas, districts, selectedDistrictId, showOnlySeasonalUnused])\n\n  return (\n    <>\n      <style jsx global>{`\n        .custom-marker > div:hover {\n          opacity: 1 !important;\n        }\n        .leaflet-marker-icon:hover {\n          z-index: 1000 !important;\n        }\n      `}</style>\n      {showHeatmap && <HeatmapLegend />}\n      <div ref={mapRef} className=\"h-full w-full\" />\n    </>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}