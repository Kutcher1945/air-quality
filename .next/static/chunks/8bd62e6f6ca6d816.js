(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,95775,e=>{"use strict";var t,n,r,l,u,o,i,a,s=e.i(43476),c=e.i(71645);function d(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function f(e,t){return null==t?function(t,n){let r=(0,c.useRef)(void 0);return r.current||(r.current=e(t,n)),r}:function(n,r){let l=(0,c.useRef)(void 0);l.current||(l.current=e(n,r));let u=(0,c.useRef)(n),{instance:o}=l.current;return(0,c.useEffect)(function(){u.current!==n&&(t(o,n,u.current),u.current=n)},[o,n,t]),l}}var p=e.i(74080);let m=(0,c.createContext)(null);function v(){let e=(0,c.use)(m);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function x(e,t){let n=(0,c.useRef)(t);(0,c.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function h(e,t){let n=(0,c.useRef)(void 0);(0,c.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function b(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function y(e,t){(0,c.useEffect)(function(){return(t.layerContainer??t.map).addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}},[t,e])}var j=e.i(32322);let g=(t=f(function({center:e,children:t,...n},r){var l;let u=new j.CircleMarker(e,n);return d(u,(l={overlayContainer:u},Object.freeze({...r,...l})))},function(e,t,n){t.center!==n.center&&e.setLatLng(t.center),null!=t.radius&&t.radius!==n.radius&&e.setRadius(t.radius)}),n=function(e){var n;let r,l=v(),u=t(b(e,l),l);return h(u.current,e.eventHandlers),y(u.current,l),n=u.current,r=(0,c.useRef)(void 0),(0,c.useEffect)(function(){if(e.pathOptions!==r.current){let t=e.pathOptions??{};n.instance.setStyle(t),r.current=t}},[n,e]),u},(0,c.forwardRef)(function(e,t){let{instance:r,context:l}=n(e).current;(0,c.useImperativeHandle)(t,()=>r);let{children:u}=e;return null==u?null:c.default.createElement(m,{value:l},u)})),w=(0,c.forwardRef)(function({bounds:e,boundsOptions:t,center:n,children:r,className:l,id:u,placeholder:o,style:i,whenReady:a,zoom:s,...d},f){let[p]=(0,c.useState)({className:l,id:u,style:i}),[v,x]=(0,c.useState)(null),h=(0,c.useRef)(void 0);(0,c.useImperativeHandle)(f,()=>v?.map??null,[v]);let b=(0,c.useCallback)(r=>{if(null!==r&&!h.current){let l=new j.Map(r,d);h.current=l,null!=n&&null!=s?l.setView(n,s):null!=e&&l.fitBounds(e,t),null!=a&&l.whenReady(a),x(Object.freeze({__version:1,map:l}))}},[]);(0,c.useEffect)(()=>()=>{v?.map.remove()},[v]);let y=v?c.default.createElement(m,{value:v},r):o??null;return c.default.createElement("div",{...p,ref:b},y)}),C=(r=function(e,t){return d(new j.Popup(e,t.overlayContainer),t)},l=function(e,t,{position:n},r){(0,c.useEffect)(function(){let{instance:l}=e;function u(e){e.popup===l&&(l.update(),r(!0))}function o(e){e.popup===l&&r(!1)}return t.map.on({popupopen:u,popupclose:o}),null==t.overlayContainer?(null!=n&&l.setLatLng(n),l.openOn(t.map)):t.overlayContainer.bindPopup(l),function(){t.map.off({popupopen:u,popupclose:o}),t.overlayContainer?.unbindPopup(),t.map.removeLayer(l)}},[e,t,r,n])},u=f(r),o=function(e,t){let n=v(),r=u(b(e,n),n);return x(n.map,e.attribution),h(r.current,e.eventHandlers),l(r.current,n,e,t),r},(0,c.forwardRef)(function(e,t){let[n,r]=(0,c.useState)(!1),{instance:l}=o(e,r).current;(0,c.useImperativeHandle)(t,()=>l),(0,c.useEffect)(function(){n&&l.update()},[l,n,e.children]);let u=l._contentNode;return u?(0,p.createPortal)(e.children,u):null})),N=(i=f(function({url:e,...t},n){return d(new j.TileLayer(e,b(t,n)),n)},function(e,t,n){!function(e,t,n){let{opacity:r,zIndex:l}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=l&&l!==n.zIndex&&e.setZIndex(l)}(e,t,n);let{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)}),a=function(e){let t=v(),n=i(b(e,t),t);return x(t.map,e.attribution),h(n.current,e.eventHandlers),y(n.current,t),n},(0,c.forwardRef)(function(e,t){let{instance:n}=a(e).current;return(0,c.useImperativeHandle)(t,()=>n),null})),R=[43.238949,76.889709];function _({sensors:e}){let[t,n]=(0,c.useState)({}),[r,l]=(0,c.useState)(new Set),u=(0,c.useMemo)(()=>e.filter(e=>null!==e.latitude&&void 0!==e.latitude&&null!==e.longitude&&void 0!==e.longitude),[e]),o=async e=>{if(!e||void 0!==t[e]||r.has(e))return;let u=new Set(r);u.add(e),l(u);try{let t=await fetch(`https://api.air.org.kz/api/stats/daily?station_id=${e}`);if(!t.ok)throw Error(`Failed ${t.status}`);let r=await t.json(),l=Array.isArray(r)?r[0]:r?.[0]||r,u={pm25:l?.pm25??l?.avg_pm25??l?.value,no2:l?.no2,datetime:l?.datetime||l?.date};n(t=>({...t,[e]:u}))}catch(t){n(t=>({...t,[e]:null}))}finally{let t=new Set(u);t.delete(e),l(t)}};return u.length?(0,s.jsxs)(w,{center:R,zoom:11,scrollWheelZoom:!0,crs:j.CRS.EPSG3395,className:"h-[480px] w-full rounded-xl border border-border",children:[(0,s.jsx)(N,{attribution:"© Yandex",url:"https://core-renderer-tiles.maps.yandex.net/tiles?l=map&x={x}&y={y}&z={z}&lang=ru_RU",maxZoom:18,minZoom:0}),u.map(e=>{var n;let l=e.latest_measurement,u=null==(n=l?.pm25)?"#6b7280":n<=15?"#1BA97C":n<=35?"#f59e0b":n<=55?"#f97316":n<=150?"#ef4444":n<=250?"#a855f7":"#581c87",i=[Number(e.latitude),Number(e.longitude)];return(0,s.jsx)(g,{center:i,radius:10,pathOptions:{color:u,fillColor:u,fillOpacity:.85,weight:2},eventHandlers:{click:()=>o(e.sensor_id.toString())},children:(0,s.jsx)(C,{children:(0,s.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,s.jsx)("p",{className:"font-semibold text-foreground",children:e.name||"Станция"}),e.district&&(0,s.jsxs)("p",{className:"text-muted-foreground",children:["Поставщик: ",e.district]}),l?(0,s.jsxs)(s.Fragment,{children:[null!==l.pm25&&void 0!==l.pm25&&(0,s.jsxs)("p",{children:["PM2.5: ",(0,s.jsx)("span",{className:"font-semibold",children:l.pm25})]}),null!==l.no2&&void 0!==l.no2&&(0,s.jsxs)("p",{children:["NO2: ",(0,s.jsx)("span",{className:"font-semibold",children:l.no2})]}),l.datetime&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Обновлено: ",new Date(l.datetime).toLocaleString()]})]}):(0,s.jsx)("p",{className:"text-muted-foreground",children:"Нет свежих измерений"}),t[e.sensor_id]?.pm25!==void 0&&t[e.sensor_id]?.pm25!==null&&(0,s.jsxs)("p",{children:["Текущее (api/stats/daily): ",(0,s.jsx)("span",{className:"font-semibold",children:t[e.sensor_id]?.pm25})]}),t[e.sensor_id]?.no2!==void 0&&t[e.sensor_id]?.no2!==null&&(0,s.jsxs)("p",{children:["NO2 (суточн.): ",(0,s.jsx)("span",{className:"font-semibold",children:t[e.sensor_id]?.no2})]}),r.has(e.sensor_id.toString())&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Обновляем..."})]})})},e.sensor_id)})]}):(0,s.jsx)("div",{className:"flex h-[480px] items-center justify-center rounded-xl border border-dashed border-border bg-muted/40 text-muted-foreground",children:"Нет данных по сенсорам для отображения"})}e.s(["default",()=>_],95775)},37154,e=>{e.n(e.i(95775))}]);