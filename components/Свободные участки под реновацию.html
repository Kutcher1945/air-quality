<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Карта участков г. Алматы</title>
    
    <!-- Подключение библиотеки Leaflet для создания карты -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <style>
        /* Стиль для контейнера карты, чтобы он занимал весь экран */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        #map {
            width: 100%;
            height: 100%;
            cursor: pointer; /* Изменяем курсор по умолчанию для карты */
        }
        /* Стили для всплывающих окон (попапов) */
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
        }
        .leaflet-popup-content {
            font-size: 14px;
            line-height: 1.6;
            max-width: 300px !important;
        }
        .leaflet-popup-content h3 {
            margin: 0 0 10px;
            color: #333;
            font-size: 16px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .leaflet-popup-content p {
            margin: 5px 0;
        }
        .leaflet-popup-content strong {
            color: #555;
        }
        /* Стиль для изображения внутри попапа */
        .leaflet-popup-content img {
            width: 100%;
            height: auto;
            margin-top: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <!-- Элемент, в котором будет отображаться карта -->
    <div id="map"></div>

    <script>
        // 1. Инициализация карты
        const map = L.map('map').setView([43.2389, 76.8512], 12);

        // 2. Добавление слоя-подложки 2GIS
        L.tileLayer('https://tile{s}.maps.2gis.com/tiles?x={x}&y={y}&z={z}&v=1', {
            subdomains: '0123',
            attribution: '&copy; <a href="https://2gis.ru/">2GIS</a>'
        }).addTo(map);
        
        // 3. Данные GeoJSON теперь встроены непосредственно в код
        const geojsonData = {
          "type": "FeatureCollection",
          "name": "merged",
          "features": [
            {
              "type": "Feature",
              "properties": { "Наименование\r\nучастка": "Айнамалы", "Пересечение улиц/адреса": "Айнамалы,Арай, Орталык", "Количество домов": "18", "Количество квартир ": 200.0, "Площадь участка": "18 га", "photo_url": "https://iili.io/KRHh7G1.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.786066, 43.245658 ], [ 76.789589, 43.240581 ], [ 76.793579, 43.241447 ], [ 76.796602, 43.241608 ], [ 76.789943, 43.245317 ], [ 76.786043, 43.245692 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Станкевича", "Пересечение улиц/адреса": "Акан серы, Чернышевского,  Станкевича, Аймаутова", "Количество домов": "8", "Количество квартир": "64", "Площадь участка": "2,5 га", "photo_url": "https://iili.io/KRJJEZb.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.951637, 43.329987 ], [ 76.950428, 43.327737 ], [ 76.952073, 43.327249 ], [ 76.953331, 43.329535 ], [ 76.951615, 43.329983 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Белградская", "Пересечение улиц/адреса": "Белградская, Шолохова,Кунгурская,Тынышпаева", "Количество домов": "8", "Количество квартир": "163", "Площадь участка": "2,8 га", "photo_url": "https://iili.io/KRHy4FS.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.941425, 43.340746 ], [ 76.942744, 43.340368 ], [ 76.941250, 43.337763 ], [ 76.939384, 43.338347 ], [ 76.941023, 43.338805 ], [ 76.941419, 43.340747 ], [ 76.941427, 43.340745 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Римского-Корсакова", "Пересечение улиц/адреса": "Бухар жырау,Байтурсынова, Габдуллина-Римского-Корсаков", "Количество домов": "12", "Площадь участка": "6,8 га", "photo_url": "https://iili.io/KRHPslj.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.926646, 43.234978 ], [ 76.928195, 43.236032 ], [ 76.931060, 43.233862 ], [ 76.928145, 43.231783 ], [ 76.927584, 43.232214 ], [ 76.927945, 43.232628 ], [ 76.927941, 43.233931 ], [ 76.926585, 43.235047 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование\r\nучастка": "Жамбыла", "Пересечение улиц/адреса": "Жамбыла,Ади Шарипова,  Шевченко,Шагабутдинова", "Количество домов": "6", "Количество квартир": "63", "Площадь участка": "1,2 га", "photo_url": "https://iili.io/KRHgy3Q.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.921494, 43.246262 ], [ 76.921676, 43.244660 ], [ 76.923363, 43.244779 ], [ 76.923141, 43.246366 ], [ 76.921460, 43.246253 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование\r\nучастка": "андосова\u0002Рыскулбекова", "Пересечение улиц/адреса": "Жандосова,Сулейменова, Рыскулбекова", "Количество домов": "24.0", "Количество квартир": "216.0", "Площадь участка": "7,2 га", "photo_url": "https://iili.io/KRHeuB2.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.879045, 43.208452 ], [ 76.879728, 43.206615 ], [ 76.883143, 43.207284 ], [ 76.882941, 43.207793 ], [ 76.882285, 43.207667 ], [ 76.881789, 43.208991 ], [ 76.879045, 43.208473 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование\r\nучастка": "Керуентау ", "Пересечение улиц/адреса": "Керуентау,Яссауи,  Спортивная,Солнечный.", "Количество домов": 24, "Количество квартир": 216, "Площадь участка": "5,4 га", "photo_url": "https://iili.io/KRHv8gI.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.840773, 43.199905 ], [ 76.842328, 43.198606 ], [ 76.845314, 43.200918 ], [ 76.843988, 43.202087 ], [ 76.840774, 43.199905 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование\r\nучастка": "Масанчи", "Пересечение улиц/адреса": "Масанчи,Абая Кашгарская,Курмангазы", "Количество домов": "10", "Количество квартир": "243", "Площадь участка": "3,8 га", "photo_url": "https://iili.io/KRHSbDu.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.928733, 43.243324 ], [ 76.929040, 43.241348 ], [ 76.930715, 43.241456 ], [ 76.930386, 43.243414 ], [ 76.928712, 43.243330 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Монтажная,Майлина", "Пересечение улиц/адреса": "Монтажная, Майлина", "Количество домов": "37", "Количество квартир": "469", "Площадь участка": "22 га", "photo_url": "https://iili.io/KRJBF2f.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.977404, 43.329793 ], [ 76.977685, 43.329779 ], [ 76.979270, 43.330008 ], [ 76.990609, 43.341314 ], [ 76.990576, 43.344031 ], [ 76.985225, 43.340840 ], [ 76.984134, 43.340095 ], [ 76.979533, 43.332794 ], [ 76.978759, 43.332058 ], [ 76.978177, 43.331344 ], [ 76.977403, 43.329789 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Мустафы Озтюрка", "Пересечение улиц/адреса": "Мустафы Озтюрка, Ауэзова,  Жандосова, Манаса", "Количество домов": "26", "Количество квартир": "216", "Площадь участка": "8,6 га", "photo_url": "https://iili.io/KRHPuwP.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.904986, 43.232184 ], [ 76.904772, 43.233882 ], [ 76.909141, 43.235310 ], [ 76.909514, 43.232514 ], [ 76.904971, 43.232191 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Масанчи,Абая", "Пересечение улиц/адреса": "прос. Абая, Масанчи,  Сатпаева,Байтурсынова", "Количество домов": "22", "Количество квартир": "250", "Площадь участка": "10 га", "photo_url": "https://iili.io/KRHZ0TQ.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.927415, 43.240864 ], [ 76.930789, 43.241037 ], [ 76.931186, 43.237409 ], [ 76.927991, 43.237214 ], [ 76.927430, 43.240900 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Лисянского", "Пересечение улиц/адреса": "прос. Аль-Фараби - Розыбакиева - Лисянского ", "Количество домов": 11, "Количество квартир": 84, "Площадь участка": "2,7 га", "photo_url": "https://iili.io/KRHt4WB.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.895974, 43.197797 ], [ 76.895938, 43.197165 ], [ 76.894434, 43.197191 ], [ 76.894428, 43.196201 ], [ 76.894542, 43.195987 ], [ 76.894789, 43.195839 ], [ 76.896111, 43.195566 ], [ 76.896418, 43.195651 ], [ 76.896850, 43.195922 ], [ 76.897610, 43.196447 ], [ 76.898743, 43.197291 ], [ 76.899136, 43.197679 ], [ 76.899163, 43.197839 ], [ 76.895955, 43.197794 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Айбасова-Котельникова", "Пересечение улиц/адреса": "прос.Сейфуллина, Айбасова,  Бехтерева,Котельникова", "Количество домов": "32", "Количество квартир": "232", "Площадь участка": "11,5 га", "photo_url": "https://iili.io/KRJfo92.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.939491, 43.315539 ], [ 76.939591, 43.310531 ], [ 76.941628, 43.310526 ], [ 76.941651, 43.313017 ], [ 76.943355, 43.314402 ], [ 76.943184, 43.315586 ], [ 76.939488, 43.315538 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Роща Баума", "Пересечение улиц/адреса": "прос.Сейфуллина,  Глазунова,Успенского", "Количество домов": "31", "Количество квартир": "350", "Площадь участка": "15,1 га", "photo_url": "https://iili.io/KRJqIJR.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.939987, 43.303263 ], [ 76.945029, 43.303270 ], [ 76.944776, 43.300366 ], [ 76.940141, 43.300524 ], [ 76.939985, 43.303278 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Жумабаева-Котельникова", "Пересечение улиц/адреса": "прос.Сейфуллина, Жумабаева,  Кассина,Котельникова", "Количество домов": "60", "Количество квартир": "480", "Площадь участка": "18,9 га", "photo_url": "https://iili.io/KRJKTrv.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.936882, 43.316830 ], [ 76.937069, 43.310488 ], [ 76.939381, 43.310558 ], [ 76.939250, 43.316902 ], [ 76.936821, 43.316837 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Успенского", "Пересечение улиц/адреса": "прос. Сейфуллина,  Крамского,Успенского", "Количество домов": "5", "Количество квартир": "40", "Площадь участка": "9,7 га", "photo_url": "https://iili.io/KRJnuOQ.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.937348, 43.295374 ], [ 76.937348, 43.298986 ], [ 76.940077, 43.299071 ], [ 76.940012, 43.295407 ], [ 76.937330, 43.295382 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование\r\nучастка": "Ровенского", "Пересечение улиц/адреса": "прос.Сейфуллина,Ровенского,Бехтерева, Жумабаева", "Количество домов": 14, "Количество квартир": 112, "Площадь участка": "17,6 га", "photo_url": "https://iili.io/KRJdpzg.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.939426, 43.322845 ], [ 76.939481, 43.316951 ], [ 76.943115, 43.316987 ], [ 76.943099, 43.320513 ], [ 76.942347, 43.322845 ], [ 76.939425, 43.322845 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование\r\nучастка": "Ровенского ", "Пересечение улиц/адреса": "прос.Сейфуллина,Ровенского,Кабардинского, Жумабаева", "Количество домов": "14", "Количество квартир": "112", "Площадь участка": "17,6 га", "photo_url": "https://iili.io/KRJ3jcl.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.939432, 43.322840 ], [ 76.939482, 43.316957 ], [ 76.943143, 43.316993 ], [ 76.943080, 43.320491 ], [ 76.942358, 43.322830 ], [ 76.939432, 43.322840 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование\r\nучастка": "Жарокова", "Пересечение улиц/адреса": "Сатпаева, Ауэзова, Жандосова,  Жарокова", "Количество домов": "13", "Количество квартир": "132", "Площадь участка": "8,29 га", "photo_url": "https://iili.io/KRH6JhF.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.904372, 43.235424 ], [ 76.901650, 43.235249 ], [ 76.900096, 43.235104 ], [ 76.900576, 43.232338 ], [ 76.904722, 43.233938 ], [ 76.904365, 43.235427 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование\r\nучастка": "Толе би", "Пересечение улиц/адреса": "Толе би,Верещагина, Карасай  батыра,Бруно", "Количество домов": "21", "Количество квартир": "163", "Площадь участка": "10,3 га", "photo_url": "https://iili.io/KRH4oib.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.887428, 43.250573 ], [ 76.883735, 43.250329 ], [ 76.884164, 43.247315 ], [ 76.886566, 43.247338 ], [ 76.887925, 43.247452 ], [ 76.887442, 43.250605 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Чернышевского", "Пересечение улиц/адреса": "Чернышевского, Акынов, Молдагалиева, Акан серы", "Количество домов": "8.0", "Количество квартир": "84.0", "Площадь участка": "2,8 га", "photo_url": "https://iili.io/KRJ9yXf.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.950555, 43.331847 ], [ 76.949856, 43.330571 ], [ 76.951537, 43.330070 ], [ 76.952237, 43.331342 ], [ 76.950554, 43.331849 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Рихарде Зорге", "Пересечение улиц/адреса": "Шолохова,Л.Толстого, Рихарде Зорге", "Количество домов": "5", "Количество квартир": "60", "Площадь участка": " га", "photo_url": "https://iili.io/KRJCC8v.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.951595, 43.337466 ], [ 76.951509, 43.337383 ], [ 76.950258, 43.335044 ], [ 76.952935, 43.334361 ], [ 76.953209, 43.335058 ], [ 76.951593, 43.337463 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Тынышбаева", "Пересечение улиц/адреса": "Щербакова,Тынышбаева, Чехова,  Шолохова", "Количество домов": "19", "Количество квартир": "188", "Площадь участка": "4,7 га", "photo_url": "https://iili.io/KRJo5v.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.944547, 43.339838 ], [ 76.946280, 43.339351 ], [ 76.944833, 43.336696 ], [ 76.943052, 43.337234 ], [ 76.944548, 43.339840 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование\r\nучастка": "Райымбека\u0002Немировича\u0002Данченко", "Пересечение улиц/адреса": "проспект Райымбека-Немировича- Данченко", "Количество домов": "3", "Количество квартир": "40", "Площадь участка": "2,7 га", "photo_url": "https://iili.io/KRHMip2.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.870142, 43.260612 ], [ 76.870745, 43.260139 ], [ 76.874208, 43.262677 ], [ 76.873808, 43.263105 ], [ 76.870154, 43.260600 ], [ 76.870224, 43.260531 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Утепова, Серкебаева", "Пересечение улиц/адреса": "проспект Серкебаева, Утепова ", "Количество домов": "12", "Количество квартир": "100", "Площадь участка": "3,5 га", "photo_url": "https://iili.io/KRHpqmJ.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.896697, 43.220165 ], [ 76.896388, 43.220038 ], [ 76.896363, 43.218876 ], [ 76.901153, 43.219174 ], [ 76.900710, 43.220141 ], [ 76.899743, 43.220098 ], [ 76.899484, 43.220652 ], [ 76.896605, 43.220153 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Сагдиева-Кунаева", "Пересечение улиц/адреса": "лиц Сагдиева – Кунаева – Рыскулова  – Саке батыра", "Количество домов": "8", "Количество квартир": "68", "Площадь участка": "1,5 га", "photo_url": "https://iili.io/KRJxLRj.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.825768, 43.189855 ], [ 76.827361, 43.188109 ], [ 76.827563, 43.187958 ], [ 76.829862, 43.189016 ], [ 76.828032, 43.190981 ], [ 76.825768, 43.189854 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование участка": "Шмелева-Розыбакиева", "Пересечение улиц/адреса": "Шмелева,Розыбакиева,Журавлева, Абиша Кекилбайулы", "Количество домов": "-", "Количество квартир": "-", "Площадь участка": "9 га", "photo_url": "https://iili.io/KRHbeuj.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.887840, 43.216058 ], [ 76.888018, 43.214857 ], [ 76.888236, 43.214844 ], [ 76.890801, 43.215049 ], [ 76.890654, 43.216207 ], [ 76.890380, 43.217765 ], [ 76.889624, 43.217706 ], [ 76.889813, 43.216218 ], [ 76.889839, 43.216166 ], [ 76.887852, 43.216060 ] ] }
            },
            {
              "type": "Feature",
              "properties": { "Наименование\r\nучастка": "Коржын", "Пересечение улиц/адреса": "улиц Яссауи, Коржын", "Количество домов": 12, "Количество квартир ": 138, "Площадь участка": " 2,6 га", "photo_url": "https://iili.io/KRHkXn4.jpg" },
              "geometry": { "type": "LineString", "coordinates": [ [ 76.836394, 43.203572 ], [ 76.837448, 43.201881 ], [ 76.838925, 43.202352 ], [ 76.837920, 43.204034 ], [ 76.836393, 43.203571 ] ] }
            }
          ]
        };

        let geojsonLayer; // Объявляем переменную для слоя GeoJSON

        // 4. Функция для обработки каждого участка (включая события мыши)
        function onEachFeature(feature, layer) {
            // -- СОЗДАНИЕ ПОПАПА --
            if (feature.properties) {
                const getProp = (keys, defaultValue = 'Не указано') => {
                    for (const key of keys) {
                        const value = feature.properties[key];
                        if (value !== null && value !== undefined && String(value).trim() !== "" && String(value).trim() !== "-") return value;
                    }
                    return defaultValue;
                };

                const name = getProp(['Наименование участка', 'Наименование\r\nучастка']);
                const area = getProp(['Площадь участка']);
                const numHouses = getProp(['Количество домов']);
                const numApartments = getProp(['Количество квартир ', 'Количество квартир']);
                const address = getProp(['Пересечение улиц/адреса', 'Пересечение улиц/адреса Количество домов Количество квартир']);
                const photoUrl = getProp(['photo_url'], null);


                let popupContent = `
                    <h3>${name}</h3>
                    <p><strong>Адрес:</strong> ${address}</p>
                    <p><strong>Площадь участка:</strong> ${area}</p>
                    <p><strong>Количество домов:</strong> ${numHouses}</p>
                    <p><strong>Количество квартир:</strong> ${numApartments}</p>
                `;

                // Если есть ссылка на фото, добавляем тег img
                if (photoUrl && photoUrl !== 'Не указано') {
                    popupContent += `<img src="${photoUrl}" alt="Фото участка ${name}">`;
                }
                
                layer.bindPopup(popupContent);
            }

            // -- ИНТЕРАКТИВНОСТЬ ПРИ НАВЕДЕНИИ --
            layer.on({
                mouseover: function (e) {
                    const hoveredLayer = e.target;
                    hoveredLayer.setStyle({
                        weight: 5,
                        color: '#e63946', // Яркий красный для подсветки
                        dashArray: '',
                        fillOpacity: 0.5 // Увеличиваем непрозрачность заливки
                    });
                },
                mouseout: function (e) {
                    // Используем geojsonLayer, чтобы сбросить стиль до исходного
                    if (geojsonLayer) {
                      geojsonLayer.resetStyle(e.target);
                    }
                }
            });
        }
        
        // 5. Добавление данных GeoJSON на карту
        geojsonLayer = L.geoJSON(geojsonData, {
            onEachFeature: onEachFeature,
            
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, {
                    radius: 6,
                    fillColor: "#3388ff",
                    color: "#fff",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                });
            },

            // Стиль по умолчанию для всех контуров
            style: function(feature) {
                return {
                    color: "#3388ff", // синий цвет контура
                    weight: 3,
                    opacity: 0.8,
                    fillColor: "#3388ff", // синий цвет заливки
                    fillOpacity: 0.2 // полупрозрачная заливка
                };
            }
        }).addTo(map);

    </script>
</body>
</html>

