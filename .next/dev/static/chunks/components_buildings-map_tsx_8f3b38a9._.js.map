{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/adilannister/admin_related/air-quality-data/components/buildings-map.tsx"],"sourcesContent":["\"use client\"\n\nimport { useEffect, useRef } from \"react\"\nimport L from \"leaflet\"\nimport \"leaflet/dist/leaflet.css\"\nimport \"leaflet.markercluster/dist/leaflet.markercluster\"\nimport \"leaflet.markercluster/dist/MarkerCluster.css\"\nimport \"leaflet.markercluster/dist/MarkerCluster.Default.css\"\nimport \"leaflet.heat\"\n\ninterface Building {\n  id: string\n  address: string\n  district: string\n  latitude: number\n  longitude: number\n  has_gas: boolean\n  building_type: string\n  building_category: \"general\" | \"izhs\" | \"susn\"\n  geometry?: {\n    type: string\n    coordinates: any\n  } | null\n  floors?: number\n  apartments?: number\n  year_built?: number\n}\n\ninterface BuildingsMapProps {\n  buildings: Building[]\n  showHeatmap?: boolean\n}\n\n// Fix Leaflet default marker icon issue\ndelete (L.Icon.Default.prototype as any)._getIconUrl\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png\",\n  iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png\",\n  shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png\",\n})\n\n// Function to create colored marker icons based on building category\nconst createMarkerIcon = (category: \"general\" | \"izhs\" | \"susn\") => {\n  // Different colors for each building type\n  const colors = {\n    general: \"#f97316\", // Orange - General buildings without gas\n    izhs: \"#3b82f6\",    // Blue - Individual housing construction (–ò–ñ–°)\n    susn: \"#ef4444\",    // Red - Multi-family buildings (–°–£–°–ù)\n  }\n\n  const emoji = {\n    general: \"üè†\", // House\n    izhs: \"üè°\",    // House with garden\n    susn: \"üè¢\",    // Office building\n  }\n\n  const color = colors[category]\n  const icon = emoji[category]\n\n  return L.divIcon({\n    className: \"custom-marker\",\n    html: `\n      <div style=\"\n        background-color: ${color};\n        width: 32px;\n        height: 32px;\n        border-radius: 50% 50% 50% 0;\n        transform: rotate(-45deg);\n        border: 3px solid white;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      \">\n        <div style=\"\n          transform: rotate(45deg);\n          color: white;\n          font-size: 18px;\n          font-weight: bold;\n        \">${icon}</div>\n      </div>\n    `,\n    iconSize: [32, 32],\n    iconAnchor: [16, 32],\n    popupAnchor: [0, -32],\n  })\n}\n\nexport default function BuildingsMap({ buildings, showHeatmap = false }: BuildingsMapProps) {\n  const mapRef = useRef<HTMLDivElement>(null)\n  const mapInstanceRef = useRef<L.Map | null>(null)\n  const heatLayerRef = useRef<any>(null)\n  const clusterGroupRef = useRef<any>(null)\n\n  useEffect(() => {\n    if (typeof window === \"undefined\" || !mapRef.current) return\n\n    // Clear previous map instance\n    if (mapInstanceRef.current) {\n      mapInstanceRef.current.remove()\n      mapInstanceRef.current = null\n    }\n\n    // Center of Almaty\n    const mapCenter: [number, number] = [43.238293, 76.945465]\n\n    // Create Leaflet map with EPSG:3395 CRS for Yandex tiles\n    const map = L.map(mapRef.current, {\n      crs: L.CRS.EPSG3395, // Yandex uses Mercator projection (EPSG:3395)\n      center: mapCenter,\n      zoom: 11,\n    })\n\n    // Add Yandex tiles layer (no API key needed!)\n    L.tileLayer(\"https://core-renderer-tiles.maps.yandex.net/tiles?l=map&x={x}&y={y}&z={z}&lang=ru_RU\", {\n      attribution: '&copy; <a href=\"https://yandex.com/maps/\">Yandex</a>',\n      maxZoom: 18,\n      minZoom: 0,\n    }).addTo(map)\n\n    if (showHeatmap) {\n      // Create heatmap layer\n      const heatData: [number, number, number][] = buildings.map((building) => [\n        building.latitude,\n        building.longitude,\n        0.5, // intensity\n      ])\n\n      // @ts-ignore leaflet.heat is attached to L by side-effect import\n      const heatLayer = L.heatLayer(heatData, {\n        radius: 25,\n        blur: 35,\n        maxZoom: 13,\n        max: 1.0,\n        gradient: {\n          0.0: \"blue\",\n          0.5: \"lime\",\n          0.7: \"yellow\",\n          0.9: \"orange\",\n          1.0: \"red\",\n        },\n      }).addTo(map)\n\n      heatLayerRef.current = heatLayer\n    } else {\n      // Cluster markers for performance on large datasets\n      // @ts-ignore markercluster is attached to L by side-effect import\n      const clusterGroup = L.markerClusterGroup({\n        disableClusteringAtZoom: 16,\n        chunkedLoading: true,\n        maxClusterRadius: 45,\n        spiderfyOnMaxZoom: true,\n        showCoverageOnHover: false,\n      })\n\n      buildings.forEach((building) => {\n        // Use different colored icon based on building category\n        const icon = createMarkerIcon(building.building_category)\n\n        const marker = L.marker([building.latitude, building.longitude], { icon }).bindPopup(\n          `\n          <div style=\"padding: 8px; min-width: 200px;\">\n            <strong style=\"font-size: 14px;\">${building.address}</strong>\n            <hr style=\"margin: 8px 0; border: none; border-top: 1px solid #e5e7eb;\">\n            <p style=\"margin: 4px 0; font-size: 12px;\"><strong>–†–∞–π–æ–Ω:</strong> ${building.district}</p>\n            <p style=\"margin: 4px 0; font-size: 12px;\"><strong>–¢–∏–ø:</strong> ${building.building_type}</p>\n            ${building.floors ? `<p style=\"margin: 4px 0; font-size: 12px;\"><strong>–≠—Ç–∞–∂–µ–π:</strong> ${building.floors}</p>` : \"\"}\n            ${building.apartments ? `<p style=\"margin: 4px 0; font-size: 12px;\"><strong>–ö–≤–∞—Ä—Ç–∏—Ä:</strong> ${building.apartments}</p>` : \"\"}\n            ${building.year_built ? `<p style=\"margin: 4px 0; font-size: 12px;\"><strong>–ì–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏:</strong> ${building.year_built}</p>` : \"\"}\n            <p style=\"margin: 8px 0 4px; color: #f97316; font-weight: bold; font-size: 12px;\">‚ö†Ô∏è –ë–µ–∑ –≥–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è</p>\n          </div>\n        `,\n        )\n\n        clusterGroup.addLayer(marker)\n\n        // Draw polygons if geometry exists\n        if (building.geometry && building.geometry.type === \"MultiPolygon\") {\n          const latLngPolys: L.LatLngExpression[][] = []\n          building.geometry.coordinates.forEach((poly: any) => {\n            // poly is array of rings, take first ring\n            const ring = poly[0]\n            const latLngs = ring.map((coord: [number, number]) => [coord[1], coord[0]]) // [lon, lat] -> [lat, lon]\n            latLngPolys.push(latLngs)\n          })\n          const htmlString = typeof icon.options.html === \"string\" ? icon.options.html : \"\"\n          L.polygon(latLngPolys, {\n            color: htmlString.includes(\"#3b82f6\")\n              ? \"#3b82f6\"\n              : htmlString.includes(\"#ef4444\")\n                ? \"#ef4444\"\n                : \"#f97316\",\n            weight: 1,\n            fillOpacity: 0.15,\n          }).addTo(map)\n        }\n      })\n\n      clusterGroup.addTo(map)\n      clusterGroupRef.current = clusterGroup\n    }\n\n    // Auto-fit bounds if there are buildings\n    if (buildings.length > 0) {\n      const bounds = L.latLngBounds(buildings.map((b) => [b.latitude, b.longitude]))\n      map.fitBounds(bounds, { padding: [50, 50] })\n    }\n\n    mapInstanceRef.current = map\n\n    return () => {\n      if (mapInstanceRef.current) {\n        mapInstanceRef.current.remove()\n        mapInstanceRef.current = null\n      }\n      heatLayerRef.current = null\n      clusterGroupRef.current = null\n    }\n  }, [buildings, showHeatmap])\n\n  return <div ref={mapRef} className=\"h-full w-full\" />\n}\n"],"names":[],"mappings":"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"}}]
}