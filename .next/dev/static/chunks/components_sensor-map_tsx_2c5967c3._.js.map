{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/adilannister/admin_related/air-quality-data/components/sensor-map.tsx"],"sourcesContent":["\"use client\"\n\nimport { useMemo } from \"react\"\nimport { CircleMarker, MapContainer, Popup, TileLayer } from \"react-leaflet\"\nimport type { LatLngExpression } from \"leaflet\"\nimport \"leaflet/dist/leaflet.css\"\n\nexport interface SensorMetric {\n  pm25?: number | null\n  no2?: number | null\n  datetime?: string | null\n  interval?: string | null\n}\n\nexport interface Sensor {\n  id: number | string\n  sensor_id: string\n  name?: string | null\n  district?: string | null\n  latitude?: number | null\n  longitude?: number | null\n  is_active?: boolean\n  latest_measurement?: SensorMetric | null\n}\n\ninterface SensorMapProps {\n  sensors: Sensor[]\n}\n\nconst DEFAULT_CENTER: LatLngExpression = [43.238949, 76.889709] // Almaty\n\nconst getMarkerColor = (pm25?: number | null) => {\n  if (pm25 === null || pm25 === undefined) return \"#6b7280\" // neutral gray\n  if (pm25 <= 15) return \"#1BA97C\" // good\n  if (pm25 <= 35) return \"#f59e0b\" // moderate\n  if (pm25 <= 55) return \"#f97316\" // sensitive\n  if (pm25 <= 150) return \"#ef4444\" // unhealthy\n  if (pm25 <= 250) return \"#a855f7\" // very unhealthy\n  return \"#581c87\" // hazardous\n}\n\nexport function SensorMap({ sensors }: SensorMapProps) {\n  const markers = useMemo(\n    () => sensors.filter((sensor) => sensor.latitude !== null && sensor.latitude !== undefined && sensor.longitude !== null && sensor.longitude !== undefined),\n    [sensors],\n  )\n\n  if (!markers.length) {\n    return (\n      <div className=\"flex h-[480px] items-center justify-center rounded-xl border border-dashed border-border bg-muted/40 text-muted-foreground\">\n        Нет данных по сенсорам для отображения\n      </div>\n    )\n  }\n\n  return (\n    <MapContainer center={DEFAULT_CENTER} zoom={11} scrollWheelZoom className=\"h-[480px] w-full rounded-xl border border-border\">\n      <TileLayer\n        attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n      />\n      {markers.map((sensor) => {\n        const metric = sensor.latest_measurement\n        const color = getMarkerColor(metric?.pm25)\n        const coordinates: LatLngExpression = [Number(sensor.latitude), Number(sensor.longitude)]\n\n        return (\n          <CircleMarker\n            key={sensor.sensor_id}\n            center={coordinates}\n            radius={10}\n            pathOptions={{\n              color,\n              fillColor: color,\n              fillOpacity: 0.85,\n              weight: 2,\n            }}\n          >\n            <Popup>\n              <div className=\"space-y-1 text-sm\">\n                <p className=\"font-semibold text-foreground\">{sensor.name || \"Станция\"}</p>\n                {sensor.district && <p className=\"text-muted-foreground\">Район: {sensor.district}</p>}\n                {metric ? (\n                  <>\n                    {metric.pm25 !== null && metric.pm25 !== undefined && (\n                      <p>\n                        PM2.5: <span className=\"font-semibold\">{metric.pm25}</span>\n                      </p>\n                    )}\n                    {metric.no2 !== null && metric.no2 !== undefined && (\n                      <p>\n                        NO2: <span className=\"font-semibold\">{metric.no2}</span>\n                      </p>\n                    )}\n                    {metric.datetime && <p className=\"text-xs text-muted-foreground\">Обновлено: {new Date(metric.datetime).toLocaleString()}</p>}\n                  </>\n                ) : (\n                  <p className=\"text-muted-foreground\">Нет свежих измерений</p>\n                )}\n              </div>\n            </Popup>\n          </CircleMarker>\n        )\n      })}\n    </MapContainer>\n  )\n}\n\nexport default SensorMap\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAAA;AAAA;AAAA;;;AAHA;;;;AA6BA,MAAM,iBAAmC;IAAC;IAAW;CAAU,CAAC,SAAS;;AAEzE,MAAM,iBAAiB,CAAC;IACtB,IAAI,SAAS,QAAQ,SAAS,WAAW,OAAO,UAAU,eAAe;;IACzE,IAAI,QAAQ,IAAI,OAAO,UAAU,OAAO;;IACxC,IAAI,QAAQ,IAAI,OAAO,UAAU,WAAW;;IAC5C,IAAI,QAAQ,IAAI,OAAO,UAAU,YAAY;;IAC7C,IAAI,QAAQ,KAAK,OAAO,UAAU,YAAY;;IAC9C,IAAI,QAAQ,KAAK,OAAO,UAAU,iBAAiB;;IACnD,OAAO,UAAU,YAAY;;AAC/B;AAEO,SAAS,UAAU,EAAE,OAAO,EAAkB;;IACnD,MAAM,UAAU,IAAA,wKAAO;sCACrB,IAAM,QAAQ,MAAM;8CAAC,CAAC,SAAW,OAAO,QAAQ,KAAK,QAAQ,OAAO,QAAQ,KAAK,aAAa,OAAO,SAAS,KAAK,QAAQ,OAAO,SAAS,KAAK;;qCAChJ;QAAC;KAAQ;IAGX,IAAI,CAAC,QAAQ,MAAM,EAAE;QACnB,qBACE,6LAAC;YAAI,WAAU;sBAA6H;;;;;;IAIhJ;IAEA,qBACE,6LAAC,0KAAY;QAAC,QAAQ;QAAgB,MAAM;QAAI,eAAe;QAAC,WAAU;;0BACxE,6LAAC,oKAAS;gBACR,aAAY;gBACZ,KAAI;;;;;;YAEL,QAAQ,GAAG,CAAC,CAAC;gBACZ,MAAM,SAAS,OAAO,kBAAkB;gBACxC,MAAM,QAAQ,eAAe,QAAQ;gBACrC,MAAM,cAAgC;oBAAC,OAAO,OAAO,QAAQ;oBAAG,OAAO,OAAO,SAAS;iBAAE;gBAEzF,qBACE,6LAAC,0KAAY;oBAEX,QAAQ;oBACR,QAAQ;oBACR,aAAa;wBACX;wBACA,WAAW;wBACX,aAAa;wBACb,QAAQ;oBACV;8BAEA,cAAA,6LAAC,4JAAK;kCACJ,cAAA,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAE,WAAU;8CAAiC,OAAO,IAAI,IAAI;;;;;;gCAC5D,OAAO,QAAQ,kBAAI,6LAAC;oCAAE,WAAU;;wCAAwB;wCAAQ,OAAO,QAAQ;;;;;;;gCAC/E,uBACC;;wCACG,OAAO,IAAI,KAAK,QAAQ,OAAO,IAAI,KAAK,2BACvC,6LAAC;;gDAAE;8DACM,6LAAC;oDAAK,WAAU;8DAAiB,OAAO,IAAI;;;;;;;;;;;;wCAGtD,OAAO,GAAG,KAAK,QAAQ,OAAO,GAAG,KAAK,2BACrC,6LAAC;;gDAAE;8DACI,6LAAC;oDAAK,WAAU;8DAAiB,OAAO,GAAG;;;;;;;;;;;;wCAGnD,OAAO,QAAQ,kBAAI,6LAAC;4CAAE,WAAU;;gDAAgC;gDAAY,IAAI,KAAK,OAAO,QAAQ,EAAE,cAAc;;;;;;;;iEAGvH,6LAAC;oCAAE,WAAU;8CAAwB;;;;;;;;;;;;;;;;;mBA7BtC,OAAO,SAAS;;;;;YAmC3B;;;;;;;AAGN;GAjEgB;KAAA;uCAmED"}}]
}